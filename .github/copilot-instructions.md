<!-- .github/copilot-instructions.md - guidance for AI coding agents -->

# AI assistant quick-start for this repository

This file gives concise, actionable instructions for an AI coding agent to be productive in this codebase.

1. What this repo is

- A Mastra-based AI tooling project that bundles: workflows, agents, MCP servers and custom tools. See `src/index.ts` for the Mastra bootstrap (workflows, agents, mcpServers).
- Documentation is fetched in real-time from shadcn-svelte.com using web scraping services under `src/services/`.

2. How to run / common developer commands

- Node engine: use Node >= 20.9.0 (see `package.json` "engines").
- Development (app-level): bun run dev (calls `mastra dev`).
- Note: for quick smoke-tests and CI checks, we use `bun run dev` only (see the smoke-test guideline below). Other MCP helper scripts exist in `package.json` but the canonical developer workflow relies on `bun run dev` for early error detection.

Important: AI-generated/progress documentation and ephemeral notes

- All AI-generated progress docs, status logs, design notes, or autogenerated markdown should be created or updated only inside the `ai-generated-docs/` folder at the repository root. Do not place generated progress docs in other directories.
- When moving or manipulating files as part of progress updates, prefer Git-aware operations (for example `git mv`) so history is preserved.

Shell command preference

- When suggesting or running commands, prefer POSIX `bash` commands. Provide exact, copyable bash snippets and use `git` for VCS operations. Wrap examples in bash code blocks and avoid platform-specific shells unless requested.

3. Big-picture architecture (quick map)

- Mastra instance (src/index.ts): central entry that composes workflows (src/mastra/workflows), agents (src/mastra/agents), and mcpServers (src/mastra/mcp-server). MCP clients are used directly in agent definitions, not registered here.
- MCP Server (src/mastra/mcp-server.\*): exposes an object `shadcn` used by `src/dev-server.ts` and `src/server.ts` via startSSE/startHTTP/close. This SERVER exposes YOUR tools to external MCP clients.
- MCP Client (src/mastra/mcp-client.ts): connects to EXTERNAL MCP servers (like Mastra's official server at mcp.mastra.ai) to USE their tools in your agents. This CLIENT consumes tools from other servers.
- Tools (src/mastra/tools/\*): each tool is created with `createTool(...)` from `@mastra/core/tools` and follows the pattern: zod input schema, execute({context}) returns result. Example tools: `shadcn-svelte-get`, `shadcn-svelte-list`, `shadcn-svelte-utility`.
- Web scraping services: `src/services/doc-fetcher.ts` handles real-time documentation fetching from shadcn-svelte.com; `src/services/component-discovery.ts` dynamically discovers available components.

4. Project-specific conventions and gotchas (do not invent alternatives)

- Tools follow Mastra patterns using `createTool` with Zod schemas for input validation (see `shadcn-svelte-get.ts`). When creating new tools, follow the established patterns for tool development.
- Tools use web scraping to fetch documentation in real-time from shadcn-svelte.com. The tooling parses markdown content returned from the scraping service.
- File path resolution: tools resolve docs relative to the tool file (they use file URL + join with `../docs`) — prefer relative paths instead of hard-coded absolute paths.
- Web scraping approach: tools use real-time web scraping to fetch documentation from shadcn-svelte.com. Components are discovered dynamically from the live website.
- Input validation: tools MUST use `zod` to validate inputs. Mastra's createTool requires Zod schemas for proper type inference and runtime validation. When updating or creating tools, use zod schemas (see existing examples in `src/mastra/tools/*`). Follow the pattern: `import { z } from "zod"` and define schemas with `z.object({...})`.

Important runtime smoke-test: when running AI-driven tests or validations, always use the MCP testing channel `#test-mcp` rather than executing repository test scripts directly. Do NOT start or run `bun run dev` from within AI tests — the development server is expected to already be running. If a local manual smoke-test is required by a developer, run `bun run dev` locally for 10–15s, but AI agents must not start it.

Caching: component analysis tools use an in-memory cache (`componentCache`) with a timeout — expect stale cached results when iterating; clear cache or restart the process during development if necessary.

5. Common edit patterns and examples (concrete references)

To add a new tool, mirror `src/mastra/tools/shadcn-svelte-get.ts`: export a tool using `createTool({ id, description, inputSchema: /* use zod schema here */, execute: async ({context}) => { ... } })`. Use Zod for schema validation as Mastra requires it for type inference. Follow existing project patterns for input parsing and error messages.

- To examine how components are discovered, inspect `src/mastra/tools/shadcn-svelte-get.ts` and `src/services/component-discovery.ts`.
- To test changes quickly: use the `#test-mcp` MCP channel to run tests and validations. Do not invoke repo test scripts or start `bun run dev` from AI-driven runs.

6. Integration & external deps

- Key runtime deps (see `package.json`): @mastra/core, @mastra/mcp, @mastra/loggers, @mastra/libsql, mastra CLI. Respect the pinned major versions when adding features unless requested.
- DB/storage: default `LibSQLStore` is configured in-memory (`url: ":memory:"`) in `src/index.ts` — switch to a file DB if persistence required.

7. Debugging tips for AI agents

- If a tool returns "not found", check the web scraping services in `src/services/` and verify the component exists on shadcn-svelte.com.
- Watch for Firecrawl API configuration in `src/services/doc-fetcher.ts`. Ensure proper environment variables are set for web scraping functionality.
- For runtime discovery iterate: change code and run `bun run dev` for 10–15s to surface issues; focus on reproducing the failing scenario in that window. If you need a focused MCP/stdio run for deeper debugging, run the specific script directly, but always prefer `#test-mcp` for AI-driven tests.

8. What not to change without confirmation

- The Mastra bootstrap (`src/index.ts`) wiring of agents/workflows/mcpServers — changes affect all runtime behavior.
- Registry format and field names used by tools (`items[].name`, `items[].files[].path`, `items[].type`).

If anything above is unclear or you want more examples (e.g., a sample tool implementation or how to call the MCP endpoints from tests), tell me which area to expand and I will iterate.
